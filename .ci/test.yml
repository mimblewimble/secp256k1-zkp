steps:
  - script: |
      mkdir -p `dirname $GUAVA_JAR`
      if [ ! -f $GUAVA_JAR ]; then wget $GUAVA_URL -O $GUAVA_JAR; fi
    displayName: Install Guava
  - script: ./autogen.sh
    displayName: Autogen
  - script: |
      bash -c 'for ((i = 0; i < 3; i++)); do sleep 360 && echo '.'; done' &
      if [ -n "$HOST" ]; then export USE_HOST="--host=$HOST"; fi
      if [ "x$HOST" = "xi686-linux-gnu" ]; then export CC="$CC -m32"; fi
      ./configure --enable-experimental=$EXPERIMENTAL --enable-endomorphism=$ENDOMORPHISM --with-field=$FIELD --with-bignum=$BIGNUM --with-scalar=$SCALAR --enable-ecmult-static-precomputation=$STATICPRECOMPUTATION --enable-module-ecdh=$ECDH --enable-module-recovery=$RECOVERY --enable-module-generator=$GENERATOR --enable-module-commitment=$COMMITMENT --enable-module-rangeproof=$RANGEPROOF --enable-module-bulletproof=$BULLETPROOF --enable-module-whitelist=$WHITELIST --enable-module-surjectionproof=$SURJECTIONPROOF --enable-module-schnorrsig=$SCHNORRSIG --enable-jni=$JNI $EXTRAFLAGS $USE_HOST && make -j2 $BUILD
    displayName: Test
    condition: eq( variables['Agent.OS'], 'Darwin' )